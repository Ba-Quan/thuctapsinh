# 9.Upgrade Nexus Repository


# MỤC LỤC


# 9.1.Giới thiệu Upgrade Nexus Repository
\- Hỗ trợ trên cả 2 phiên bản **Nexus Repository OSS** và **Nexus Repository Pro**.  
\- Upgrade Nexus Repository Manager là cần thiết để có sử dụng các tính năng mới, sửa lỗi, cả thiện hiệu năng và các lợi thế khác.  

## 9.2.Hướng dẫn Upgrade Nexus Repository trên Centos 7.5.1804
\- Tại thời điểm này (ngày 13/10/2018), Nexus đã ra phiên bản `3.14`. Vì vậy, mình chỉ hướng dẫn upgrade từ phiên bản Nexus `3.9.0` đến một phiên bản mới hơn bất kỳ (ví dụ như 3.10.0, 3.11.0, 3.12.0, 3.12.1, 3.13.0, 3.14.0).  
### 9.2.1.Các bước như sau
\- Stop dịch vụ Nexus.  
\- Tìm vị trí thư mục `data` và thư mục `application` của Nexus Repo Manager.  
\- Backup dữ liệu của Nexus Repo Manager đến vị trí khác.  
\- Tải phiên bản Nexus mới.  
Link tải: https://help.sonatype.com/repomanager3/download/download-archives---repository-manager-3

Sử dụng lệnh `tar xvfz <file>.tar.gz` để giải nén.  
\- So sánh nội dung file `<application_directory>/bin/nexus.vmoptions` của 2 phiên bản cũ và mới. Có thể bạn đã thay đổi một số tùy chọn như sau:  
- default location của thư mục Data (`-Dkaraf.data=../sonatype-work/nexus3`)
- default location của thư mục temporary (`-Djava.io.tmpdir=../sonatype-work/nexus3/tmp`)
- Java virtual machine memory (`-Xms2703M`, `-Xmx2703M` và `-XX:MaxDirectMemorySize=2703M`)
- và một số tùy chọn khác

Nếu bạn đã thay đổi, bạn cần sửa thủ công trên phiên bản mới sao cho phù hợp.  

\- So sánh nội dung file `<application_directory>/bin/nexus.rc` của 2 phiên bản cũ và mới.  
Nếu bạn đã thay đổi, bạn cần sửa thủ công trên phiên bản mới sao cho phù hợp.  

\- Copy hoặc move nội dụng `<nexus-version-old>/data` overwirte lên nội dụng của `/sonatype-work/nexus3/`.  
\- Sau đó, xóa thư mục `data` và thư mục `application` của phiên bản cũ, thay thế bằng thư mục `data` và thư mục `application` của phiên bản mới.  
\- Start Nexus, thực hiện lệnh:  
```
service nexus start
```

### 9.2.2.Ví dụ Upgrade Nexus từ phiên bản 3.9.0 lên phiển bản 3.13.0
\- Ở đây mình đã cài Nexus từ phiên bản 3.9.0 theo hướng dẫn:  
[Hướng dẫn cài đặt và cấu hình Nexus](3.Caidat-cauhinh-Nexus-repo-manager.md)

Thư mục `data` và thư mục `application` mình để trong thư mục `/opt`.  
\- Stop dịch vụ Nexus. Sử dụng lệnh:  
```
service nexus stop
```

\- Tìm vị trí thư mục `data` và thư mục `application` của Nexus Repo Manager.  
2 thư mục này là `/opt/sonatype-work/` và `/opt/nexus`.  
\- Backup dữ liệu của Nexus Repo Manager đến vị trí khác.  
\- Tải phiên bản Nexus mới.  
Thực hiện lệnh:  
```
wget http://download.sonatype.com/nexus/3/nexus-3.13.0-01-unix.tar.gz -O /root/nexus-3.13.0-01-unix.tar.gz
```

Thực hiện lệnh để giải nén:  
```
tar xvfz nexus-3.13.0-01-unix.tar.gz
```

Sau khi giải nén tạo ra 2 thư mục `sonatype-work` và `nexus-3.13.0-01`.  

\- So sánh nội dung file `<application_directory>/bin/nexus.vmoptions` của 2 phiên bản cũ và mới. Nếu bạn đã thay đổi, bạn cần sửa thủ công trên phiên bản mới sao cho phù hợp.  
\- So sánh nội dung file `<application_directory>/bin/nexus.rc` của 2 phiên bản cũ và mới.  
Nếu bạn đã thay đổi, bạn cần sửa thủ công trên phiên bản mới sao cho phù hợp.  

\- Copy hoặc move nội dụng `<nexus-version-old>/data` overwirte lên nội dụng của `/sonatype-work/nexus3/`.  
Thực hiện lênh:  
```
cp -r /opt/sonatype-work/nexus3/* /root/sonatype-work/nexus3/
```

\- Sau đó, xóa thư mục `data` và thư mục `application` của phiên bản cũ, thay thế bằng thư mục `data` và thư mục `application` của phiên bản mới.  

Thực hiện lệnh:  
```
rm -rf /opt/nexus
rm -rf /opt/sonatype-work
mv /root/nexus-3.13.0-01 /opt/nexus
mv /root/sonatype-work /opt
chown -R nexus:nexus /opt/nexus
chown -R nexus:nexus /opt/sonatype-work
```

\- Start Nexus, thực hiện lệnh:  
```
service nexus start
```
















