<a name="Volume Manager">

# Logical Volume Manager (LVM)

### Mục lục

[1. Giới thiệu về Logical Volume Manager (LVM)](#Gioithieu)
- [1.1 LVM là gì](#LVM)
- [1.2 Vai trò của LVM](#Vaitro)
- [1.3 Các thành phần trong LVM](#Thanhphan)

[2. Hướng dẫn sử dụng LVM](#Huongdan)
- [2.1 Chuẩn bị](#Chuanbi)
- [2.2 Tạo Logical Volume trên LVM](#Taolvm)
- [2.3 Thay đổi dung lượng Logical Volume trên LVM](#Thaydoilv)
- [2.4 Thay đổi dung lượng Volume Group trên LVM](#Thaydoivg)
- [2.5 Xóa Logical Volume, Volume Group, Physical Volume](#Xoa)


<a name="Gioithieu"></a>
## 1. Giới thiệu về Logical Volume Manager (LVM)

<a name="LVM"></a>
### 1.1 LVM là gì

Logical Volume Manager (LVM): là phương pháp cho phép ấn định không gian đĩa cứng thành những logical Volume khiến cho việc thay đổi kích thước trở nên dễ dàng hơn (so với partition). Với kỹ thuật Logical Volume Manager (LVM) bạn có thể thay đổi kích thước mà không cần phải sửa lại table của OS. Điều này thật hữu ich với những trường hợp bạn đã sử dụng hết phần bộ nhớ còn trống của partition và muốn mở rộng dung lượng của nó

<a name="Vaitro"></a>
### 1.2 Vai trò của LVM

LVM là kỹ thuật quản lý việc thay đổi kích thước lưu trữ của ổ cứng

<ul>
<li>Không để hệ thống bị gián đoạn hoạt động</li>

<li>Không làm hỏng dịch vụ</li>

<li>Có thể kết hợp Hot Swapping (thao tác thay thế nóng các thành phần bên trong máy tính)</li>
</ul>

<a name="Thanhphan"></a>
### 1.3 Các thành phần trong LVM

**Mô hình các thành phần trong LVM**

<img src="https://imgur.com/cSZtm4U.jpg">

**Hard drives – Drives**

Thiết bị lưu trữ dữ liệu, ví dụ như trong linux nó là `/dev/sda`

**Partition**

Partitions là các phân vùng của Hard drives, mỗi Hard drives có 4 partition, trong đó partition bao gồm 2 loại là primary partition và extended partition

- **Primary partition:**
<ul>
<li>Phân vùng chính, có thể khởi động</li>
<li>Mỗi đĩa cứng có thể có tối đa 4 phân vùng này</li>
</ul>

- **Extended partition:**
<ul>
<li>Phân vùng mở rộng, có thể tạo những vùng luân lý</li>
</ul>

**Physical Volumes**

Là một cách gọi khác của partition trong kỹ thuật LVM, nó là những thành phần cơ bản được sử dụng bởi LVM. Một Physical Volume không thể mở rộng ra ngoài phạm vi một ổ đĩa.

Chúng ta có thể kết hợp nhiều Physical Volume thành Volume Groups

**Volume Group**

Nhiều Physical Volume trên những ổ đĩa khác nhau được kết hợp lại thành một Volume Group 

<img src="https://imgur.com/DQajk8R.jpg">

Volume Group được sử dụng để tạo ra các Logical Volume, trong đó người dùng có thể tạo, thay đổi kích thước, lưu trữ, gỡ bỏ và sử dụng.

*Một điểm cần lưu ý là boot loader không thể đọc /boot khi nó nằm trên Logical Volume Group. Do đó không thể sử dụng kỹ thuật LVM với /boot mount point*

**Logical Volume**

Volume Group được chia nhỏ thành nhiều Logical Volume, mỗi Logical Volume có ý nghĩa tương tự như partition. Nó được dùng cho các mount point và được format với những định dạng khác nhau như ext2, ext3, ext4,...

<img src="https://imgur.com/5SqMQFq.jpg">

Khi dung lượng của Logical Volume được sử dụng hết ta có thể đưa thêm ổ đĩa mới bổ sung cho Volume Group và do đó tăng được dung lượng của Logical Volume

Ví dụ bạn có 4 ổ đĩa mỗi ổ 5GB khi bạn kết hợp nó lại thành 1 volume group 20GB, và bạn có thể tạo ra 2 logical volumes mỗi disk 10GB

**File Systems**

<ul>
<li>Tổ chức và kiểm soát các tập tin</li>
 
<li>Được lưu trữ trên ổ đĩa cho phép truy cập nhanh chóng và an toàn</li>

<li>Sắp xếp dữ liệu trên đĩa cứng máy tính</li>

<li>Quản lý vị trí vật lý của mọi thành phần dữ liệu</li>
</ul>

## 2. Hướng dẫn sử dụng LVM

### 2.1 chuẩn bị
- Tạo máy ảo trên vmware Workstation cài hệ điều hành ubuntu server 12.04
- Add thêm một số ổ cứng vào máy ảo

<img src ="https://imgur.com/kuTTbGY.jpg">

## 2.2 Tạo Logical Volume trên LVM

### B1. Kiểm tra các Hard Drives có trên hệ thống

Bạn có thể kiểm tra và xem những Hard Drives nào có trên hệ thống bằng lệnh `lsblk`

<img src="https://imgur.com/9zUxEML.jpg">

Trong đó sdb, sdc..là các Hard Drives mà mình mới thêm vào

**B2. Tạo Partition**

Từ các Hard Drives trên hệ thống, bạn tạo các partition. Ở đây, từ sdb, mình tạo các partition bằng cách sử dụng lệnh sau `fdisk /dev/sdb`

<img src="https://imgur.com/rb3TYU0.jpg">

<li>Trong đó bạn chọn `n` để bắt đầu tạo partition</li>

<li>Bạn chọn `p` để tạo partition primary</li>

<li>Bạn chọn `1` để tạo partition primary 1</li>

<li>Tại `First sector (2048-20971519, default 2048)` bạn để mặc định</li>

<li>Tại `Last sector, +sectors or +size{K,M,G} (2048-20971519, default 20971519)` bạn chọn `+1G` để partition bạn tạo ra có dung lượng 1 G</li>

<li>Bạn chọn `w` để lưu lại và thoát.</li>

Tiếp theo bạn thay đổi định dạng của partition vừa mới tạo thành LVM

<img src="https://imgur.com/MtBc84x.jpg">

<li>Bạn chọn `t` để thay đổi định dạng partition</li>

<li>Bạn chọn `8e` để đổi thành LVM</li>

Tương tự, bạn tạo thêm các partition primary từ sdb

<img src="https://imgur.com/cyvCCJ1.jpg">

Tạo các partition primary từ `sdc` bằng lệnh `fdisk /dev/sdc`

<img src="https://imgur.com/cyvCCJ1.jpg">

**B3. Tạo Physical Volume**

Tạo các Physical Volume là `/dev/sdc1` và `/dev/sdd1` bằng các lệnh sau:

`# pvcreate /dev/sdc1`

`# pvcreate /dev/sdd1`

Bạn có thể kiểm tra các Physical Volume bằng câu lệnh `pvs` hoặc có thể sử dụng lệnh `pvdisplay`

<img src="https://imgur.com/cyvCCJ1.jpg">

**B4. Tạo Volume Group**

Tiếp theo, mình sẽ nhóm các Physical Volume thành 1 Volume Group bằng cách sử dụng câu lệnh sau:

`# vgcreate vg-demo1 /dev/sdb1 /dev/sdc1`

Trong đó `vg-demo1` là tên của Volume Group

Có thể sử dụng câu lệnh sau để kiểm tra lại các Volume Group đã tạo

`# vgs`

`# vgdisplay`

<img src="https://imgur.com/qLmraoS.jpg">

**B5. Tạo Logical Volume**

Từ một Volume Group, chúng ta có thể tạo ra các Logical Volume bằng cách sử dụng lệnh sau:

`# lvcreate -L 1G -n lv-demo1 vg-demo1`

-L: Chỉ ra dung lượng của logical volume

-n: Chỉ ra tên của logical volume

Trong đó `lv-demo1` là tên Logical Volume, `vg-demo1` là Volume Group mà mình vừa tạo ở bước trước

*Lưu ý là chúng ta có thể tạo nhiều Logical Volume từ 1 Volume Group*

Có thể sử dụng câu lệnh sau để kiểm tra lại các Logical Volume đã tạo

`# lvs`

`# lvdisplay`

<img src="https://imgur.com/y2sW71I.jpg">

**B6. Định dạng Logical Volume**

Để format các Logical Volume thành các định dạng như ext2, ext3, ext4, ta có thể làm như sau:

`# mkfs -t ext4 /dev/vg-demo1/lv-demo1`

<img src="https://imgur.com/qULftBb.jpg">

**B7. Mount và sử dụng**

Trong bài lab này, mình sẽ tạo ra một thư mục để mount Logical Volume đã tạo vào thư mục đó

`# mkdir demo1`

Tiến hành mount logical volume `lv-demo1` vào thư mục `demo1` như sau:

`# mount /dev/vg-demo1/lv-demo1 demo1`

Kiểm tra lại dung lượng của thư mục đã được mount:

`# df -h`

<img src="https://imgur.com/qULftBb.jpg">

<a name="Thaydoilv"></a>